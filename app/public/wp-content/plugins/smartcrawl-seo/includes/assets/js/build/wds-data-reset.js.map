{"version":3,"sources":["../es6/wds-data-reset.js"],"names":["$","window","Wds","Data_Reset","templates","success","tpl_compile","template","error","multisite_warning","multisite_progress","multisite_success","init","document","on","e","handle_reset_button_click","handle_multisite_reset_button_click","$button","target","closest","add_loading_class","reset","nonce","get_nonce","post","done","show_success_message","reload_page","fail","show_error_message","get_modal","val","markup","get_modal_body","html","reset_multisite","get_multisite_nonce","data","total_sites","completed_sites","progress_message","show_multisite_progress_bar","update_multisite_progress","show_multisite_success_message","show_multisite_error_message","get_multisite_modal_body","find","progress_bar","get_multisite_progress_bar","length","site_progress","update_progress_bar","action","deferred","Deferred","ajaxurl","_wpnonce","resolve","reject","get_multisite_modal","addClass","setTimeout","location","reload","jQuery"],"mappings":"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","sourcesContent":[";(function ($) {\n\twindow.Wds = window.Wds || {};\n\n\tclass Data_Reset {\n\t\tconstructor() {\n\t\t\tthis.templates = {\n\t\t\t\tsuccess: window.Wds.tpl_compile(window.Wds.template('reset', 'success')),\n\t\t\t\terror: window.Wds.tpl_compile(window.Wds.template('reset', 'error')),\n\t\t\t\tmultisite_warning: window.Wds.tpl_compile(window.Wds.template('reset', 'multisite-warning')),\n\t\t\t\tmultisite_progress: window.Wds.tpl_compile(window.Wds.template('reset', 'multisite-progress')),\n\t\t\t\tmultisite_success: window.Wds.tpl_compile(window.Wds.template('reset', 'multisite-success')),\n\t\t\t};\n\n\t\t\tthis.init();\n\t\t}\n\n\t\tinit() {\n\t\t\t$(document)\n\t\t\t\t.on('click', '.wds-data-reset-button', (e) => this.handle_reset_button_click(e))\n\t\t\t\t.on('click', '.wds-multisite-data-reset-button', (e) => this.handle_multisite_reset_button_click(e));\n\t\t}\n\n\t\thandle_reset_button_click(e) {\n\t\t\tlet $button = $(e.target).closest('button');\n\t\t\tData_Reset.add_loading_class($button);\n\n\t\t\tthis.reset();\n\t\t}\n\n\t\treset() {\n\t\t\tlet nonce = this.get_nonce();\n\n\t\t\treturn this.post('wds_data_reset', nonce)\n\t\t\t\t.done(() => {\n\t\t\t\t\tthis.show_success_message();\n\t\t\t\t\tData_Reset.reload_page();\n\t\t\t\t})\n\t\t\t\t.fail(() => this.show_error_message());\n\t\t}\n\n\t\tget_modal() {\n\t\t\treturn $('#wds-data-reset-modal');\n\t\t}\n\n\t\tget_modal_body() {\n\t\t\treturn $('.wds-data-reset-modal-body', this.get_modal());\n\t\t}\n\n\t\tget_nonce() {\n\t\t\treturn $('[name=\"_data_reset_nonce\"]', this.get_modal()).val();\n\t\t}\n\n\t\tshow_success_message() {\n\t\t\tlet markup = this.templates.success({});\n\t\t\tthis.get_modal_body().html(markup);\n\t\t}\n\n\t\tshow_error_message() {\n\t\t\tlet markup = this.templates.error({});\n\t\t\tthis.get_modal_body().html(markup);\n\t\t}\n\n\t\thandle_multisite_reset_button_click(e) {\n\t\t\tlet $button = $(e.target).closest('button');\n\t\t\tData_Reset.add_loading_class($button);\n\n\t\t\tthis.reset_multisite();\n\t\t}\n\n\t\treset_multisite() {\n\t\t\tlet nonce = this.get_multisite_nonce();\n\n\t\t\treturn this.post('wds_multisite_data_reset', nonce)\n\t\t\t\t.done(\n\t\t\t\t\t/**\n\t\t\t\t\t * @param {{total_sites:string, completed_sites:string}} data\n\t\t\t\t\t */\n\t\t\t\t\t(data) => {\n\t\t\t\t\t\tlet total_sites = data.total_sites,\n\t\t\t\t\t\t\tcompleted_sites = data.completed_sites,\n\t\t\t\t\t\t\tprogress_message = data.progress_message;\n\n\t\t\t\t\t\tthis.show_multisite_progress_bar(progress_message);\n\t\t\t\t\t\tthis.update_multisite_progress(total_sites, completed_sites);\n\n\t\t\t\t\t\tif (total_sites !== completed_sites) {\n\t\t\t\t\t\t\tthis.reset_multisite();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.show_multisite_success_message();\n\t\t\t\t\t\t\tData_Reset.reload_page();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t.fail(() => this.show_multisite_error_message());\n\t\t}\n\n\t\tshow_multisite_progress_bar(progress_message) {\n\t\t\tlet markup = this.templates.multisite_progress({progress_message: progress_message});\n\t\t\tthis.get_multisite_modal_body().html(markup);\n\t\t}\n\n\t\tshow_multisite_error_message() {\n\t\t\tlet markup = this.templates.error({});\n\t\t\tthis.get_multisite_modal_body().html(markup);\n\t\t}\n\n\t\tshow_multisite_success_message() {\n\t\t\tlet markup = this.templates.multisite_success({});\n\t\t\tthis.get_multisite_modal_body().html(markup);\n\t\t}\n\n\t\tget_multisite_progress_bar() {\n\t\t\treturn this.get_multisite_modal_body().find('.wds-progress');\n\t\t}\n\n\t\tupdate_multisite_progress(total_sites, completed_sites) {\n\t\t\tlet progress_bar = this.get_multisite_progress_bar();\n\t\t\tif (progress_bar.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet site_progress = total_sites > 0\n\t\t\t\t? (completed_sites / total_sites) * 100\n\t\t\t\t: 0;\n\n\t\t\tWds.update_progress_bar(progress_bar, site_progress);\n\t\t}\n\n\t\tpost(action, nonce) {\n\t\t\tlet deferred = new $.Deferred();\n\n\t\t\t$.post(ajaxurl, {\n\t\t\t\taction: action,\n\t\t\t\t_wpnonce: nonce\n\t\t\t}).done((data) => {\n\t\t\t\tdata = (data || {});\n\t\t\t\tif (data.success) {\n\t\t\t\t\tdeferred.resolve(data.data);\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.reject();\n\t\t\t\t}\n\t\t\t}).fail(deferred.reject);\n\n\t\t\treturn deferred;\n\t\t}\n\n\t\tget_multisite_nonce() {\n\t\t\treturn $('[name=\"_multi_data_reset_nonce\"]', this.get_multisite_modal()).val();\n\t\t}\n\n\t\tget_multisite_modal_body() {\n\t\t\treturn $('.wds-multisite-data-reset-modal-body', this.get_multisite_modal());\n\t\t}\n\n\t\tget_multisite_modal() {\n\t\t\treturn $('#wds-multisite-data-reset-modal');\n\t\t}\n\n\t\tstatic add_loading_class($button) {\n\t\t\treturn $button.addClass('sui-button-onload');\n\t\t}\n\n\t\tstatic reload_page() {\n\t\t\tsetTimeout(() => window.location.reload(), 1500);\n\t\t}\n\t}\n\n\t$(function () {\n\t\tnew Data_Reset();\n\t});\n})(jQuery);\n"],"file":"wds-data-reset.js"}